include ../Makefile.boilerplate

CXREF = ../../src/c-xref
ARGUMENTS = -no-stdoptions -xrefactory-II -refactory -xrefrc $(CURDIR)/.c-xrefrc -p $(CURDIR) -rfct-add-param -olcxparnum=1 -rfct-param1="int arg" -rfct-param2=42 -olcursor=16 $(CURDIR)/hello.c

$(TEST): clean
	$(CXREF) $(ARGUMENTS) -log=log $(EXTRA) > output.tmp
	@$(NORMALIZE) output.tmp | grep -v progress > output
	@$(VERIFY)

trace: EXTRA=-trace
trace: $(TEST)

clean:
	@-rm -rf CXrefs output.log output.tmp output log

debug: DEBUGGER=gdb
debug:
	$(DEBUGGER) $(CXREF) -ex 'br main' -ex 'run $(ARGUMENTS)'
